---
import { getEntry } from "astro:content";
import { getCollection } from "astro:content";
import DevlogLayout from "~layouts/DevlogLayout.astro";

export async function getStaticPaths() {
  const devlogs = await getCollection("devlogs");

  return await Promise.all(
    devlogs.map(async (devlog) => ({
      params: {
        project: devlog.data.project.id,
        devlog: devlog.id.split("/").pop()!,
      },
      props: {
        project: await getEntry("projects", devlog.data.project.id)!,
        devlog,
        devlogs: devlogs.filter(
          (log) => log.data.project.id === devlog.data.project.id
        ),
      },
    }))
  );
}

const { project, devlogs, devlog } = Astro.props;
---

<DevlogLayout project={project} devlogs={devlogs} devlog={devlog} />
